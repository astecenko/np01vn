ОПИСАНИЕ
==============

NP01VN
--------------
Передача данных в ОАСУП реализована в FrmJournal.OnShow, причем там реализован и вариант когда просто осуществляется просмотр журнала и вариант когда осуществляется передача даных в ОАСУП. Расшифровка значения поля Kod для разных видок корректировок описан в комментариях модуля NewString.pas:
{
  Коды для Kod:
  1 - таблица корректировка плана "таблица"
  2 - строка "строка"
  3 - таблица корректировки лимита месяц "лимит"  ТМЦ
  4 - таблица корректировки лимита квартал "лимит" ТМЦ
  5 - таблица корректировки остатка лимита месяц "ост/л" ТМЦ
  6 - корректировка плана и лимита 
  7 - корректировка лимита
  8 - корректировка остатка лимита

  Расшифровка Kod2 по значению кодов таблиц:
  Когда задумывалось с Код2
1,6,7: kod2 3 символьное число. 1символ - номер квартала на который корректировка,
       2 символ - номер месяца в котором была создана запись о корректировке,
       3 символ - тип корректировки (0-пред. , 1-текущ, 2-след. квартал)
3,5: kod2 1-2х символьное число - номер месяца на который корректировка [1:12]
4: kod2 3 символьное число. 1 символ - номер квартала на который корректировка,
       2 символ - номер месяца в котором была создана запись,
       3 символ - тип корректировки (1-текущ., 2-следующ. квартал)
8: kod2 3 символьное число. 1 символ - номер текущего кварталал,
       2 символ - номер текущего месяца,
       3 символ - тип корректировки (1-текущ, 2-следующ мес)
}


NP01VN_Maket
--------------

                            
NP01VN01
--------------


NP01VN02
--------------

                            
NP01VN_CFG
--------------
Есть задумка сделать утилиту для конфигурирования, т.е. удобного внесения изменений в конфигурационные файлы приложений входящих в состав комплекса.


КОНФИГУРИРОВАНИЕ

Исполняемый модули для 104, 153, и БФиВБД располагаются в k:\PDO\NP01VN_2\Prg\
Исполняемые модули для 118, 119 и т.д. располагаются в \\nevz\nevz\ASUP_Public\NP01VN\PRG\
В случае обновления программы обновлять надо и там и там.
7z.exe - используется в NP01VN_Maket (надо переделать на 7z.dll)
7z.dll - используется в NP01VN  
TUTIL32.DLL - используется в NP01VN 
NP01VN.exe - исполняемый модуль NP01VN 
NP01VN_maket.exe - исполняемый модуль NP01VN_Maket 
Pdxrbld.exe - используется в NP01VN
np01vn_division.ini - используется в NP01VN, настройки доступа по подразделениям, должен лежать в одном каталоге с исполняемым модулем NP01VN 
NP01VN.txt - используется в NP01VN, при обновлении программы необходимо обновлять содержимое данного файла
NP01VN_maket.txt - используется в NP01VN_maket, при обновлении программы необходимо обновлять содержимое данного файла

NP01VN01
Исполняемый модуль: \\nevz\nevz\ASUP_Data1\LWS\prg_dlph\, \\nevz\nevz\Ceh\PRG\PROGS\
Хранилище данных: \\nevz\nevz\ASUP_Data1\BD-ASU\NET\NP01VN\
Архив: \\nevz\nevz\ASUP_Data1\BD-ASU\NET\NP01VN\Arc\

NP01VN02
Исполняемый модуль: \\nevz\nevz\ASUP_Data1\LWS\prg_dlph\
Хранилище данных: \\nevz\nevz\ASUP_Data1\BD-ASU\NET\NP01VN\NP01VN02\
Архив: \\nevz\nevz\ASUP_Data1\BD-ASU\NET\NP01VN\ARC02\ 

Расположение каталогов для NP01VN01 и NP02VN02 берется из bases.dbf расположенного в рабочем каталоге с программой, так как эти программы запускаются из "Справочники АСУП" или "АСУ-Цех", предполагается что bases.dbf будет присутствовать в рабочем каталоге программы.


Хранилища данных NP01VN и NP01VN_Maket:
ПДО (104):
Журнал k:\PDO\NP01VN_2\Jrnl\
Сетевое хранилище k:\PDO\NP01VN_2\P8\
Архив k:\PDO\NP01VN_ARHIV\104\DATA\

ОПиАПД (153)
Журнал k:\PDO\NP01VN_ОПиАПД\Jrnl\
Сетевое хранилище k:\PDO\NP01VN_ОПиАПД\P8\
Архив k:\PDO\NP01VN_ARHIV\153\DATA\

ОПиУТМЦ (118)
Журнал \\nevz\nevz\ASUP_Public\NP01VN\118\Jrnl\ 
Сетевое хранилище \\nevz\nevz\ASUP_Public\NP01VN\118\Data\
Архив \\nevz\nevz\ASUP_Public\NP01VN\ARC\118\

ОПК (119)
Журнал \\nevz\nevz\ASUP_Public\NP01VN\119\Jrnl\ 
Сетевое хранилище \\nevz\nevz\ASUP_Public\NP01VN\119\Data\
Архив \\nevz\nevz\ASUP_Public\NP01VN\ARC\119\

Локальные настройки программ комплекса хранятся в соответствующих подкаталога каталога %AppData%\NEVZ\OASUP\


==============
NP01VN
--------------
Конфигурационные файлы и файлы необходимые для работы программы находятся в каталоге %AppData%\NEVZ\OASUP\NP01VN\
В случае если файлы не обнаружены в данном каталоге они ищуться в каталоге размещения исполняемого модуля программы (NP01VN.exe) и копируются автоматически в каталог 
NP01VN.sei - единицы измерения в виде код=значение, генерируется по sm07st.db
NP01VN.ini - основной файл настроек программы
np01vn_chklst1.ini - файл настроек конфигураций полей для импорта таблиц в текстовом формате, создается при сохранении наборов столбцов
NP01VN-01.txt - файл содержит наименования корректировок по умолчанию (8 строк на 8 типов корректировок), настраивается через окно настройки NP01VN 
sm07st.db

Значения параметров NP01VN.ini
[location]
basespdo=K:\SYSTEM\Bases.dbf 
startdir=d:\temp\NP01VN\           ; каталог хранения таблц БД на ПК пользователя
netfiledir=K:\BD-ASU\NET           ; каталог размещения сетевых файлов блокировок BDE
netdir=d:\temp\000\                ; каталог размещения хранилища БД (туда копируются таблицы БД при передаче в ОАСУП)
journaldir=d:\temp\000\Jrnl\       ; каталог размещения таблиц БД Журнала 
ext_app=                           ; путь к внешнему приложению, если указать то в первом окне программы появится кнопка для запуска этого приложения. Необходимость в данном функционале возникла когда был конфликт BDE (использовались бибиблиотеки BDE из разных мест)  
log_dir=\\nevz\nevz\WorkShop\Logs\ ; каталог сохранения журнала работы приложения
tms_arhiv2=d:\Temp\000\ArhivTMS\   ; каталог БД архива корректировок по ТМЦ
chert_arhiv=d:\ProjectsD\NP01VN\NP01VN02\Arhv\ ; каталог БД архива корректировок по чертежам
workname=NP01VN_1.08.13            ; наименование текущего рабочего документа
outputfile=D:\MyDocs\Планирование\NP01VN_1.08.13.xls ; путь к файлу Excel по текущему рабочему документу

[sheet]                  ; настройки вывода в Ms Excel
fontsize=12              ; размер шрифта по умолчанию 
chertfontsize=12         ; размер шрифта поля Чертеж/ТМЦ
papersize=9              ; размер бумаги, 9 - А4
paperorientation=1       ; ориентация бумаги, 1 - книжная
pagebreak=0              ; разделять ли корректировки чертежей и ТМЦ разрывами страниц 
show=1                   ; открывать или нет Excel после завершения вывода отчета 
print_title=0            ; выводить или нет наименования чертежей и ТМЦ
exchange_primech=1       ; заменять подряд идущие примечания другой строкой
exchange_title=1         ; заменять подряд идущие наименования другой строкой
exchange_primech_text="- ; текст для замены повторяющихся примечаний 
exchange_title_text="-   ; текст для замены повторяющихся наименований 
colwidth1=0              ;               
colwidth2=-1
[service]
debug=0          ; отладочный режим       
show_tips=0      ; показывать или нет подсказки при редактировании таблиц
autosave=0       ; вкл/выкл автосохранения при редактировании таблиц
autosave_time=60 ; интервалы между автосохранением в секундах
[option]
division=104  ; номер подразделения           
[update]
firstline=Версия  1.4.3.12 от 11.07.2013 ; версия программы, берется из первой строки файла NP01VN.txt в одном каталоге с исполняемым модулем программы, в случае изменения этой строки программа считает что она оновилась
[template]
dest_pos=Начальнику ОАСУП ; верхняя часть документа 
dest_name=Цапу Ю.Г.       ; верхняя часть документа
sign_pos=                 ; шаблон для нижней части документа, не используется
sign_name=                ; шаблон для нижней части документа, не используется

Конфигурационный файл np01vn_division.ini (должен располагаться в одном каталоге с исполняемым модулем NP01VN), пример файла:
[104]; секция - номер подразделения
; ПДО
cods=1,2,3,4,5,6,7,8 ; коды доступных корректировок
[118]
; ОПиУТМЦ
cods=5 
podrazd=118,818 ; доступные при редактированни корректировок ТМЦ коды подразделения
shorten=1 ; не полный по функционалу вариант работы программы
monthchk=1 ; проверка корректировок на "только текущий месяц"
snyatie=1 ; доступна опция создания табицы "СНЯТИЕ..." как копии таблицы корректировок ТМЦ с измененным признаком


NP01VN_Maket
--------------
Конфигурационный файл NP01VN.ini
[location]
basespdo=K:\SYSTEM\Bases.dbf
workname=NP01VN_7654321
startdir=d:\temp\NP01VN\
outputfile=d:\Мои документы\NP01VN_7654321.xls
codesfile=d:\ProjectsD\NP01VN_NEW\trunk\NP01VN
netfiledir=K:\BD-ASU\NET
netdir42= ; каталог по умолчанию для сохранения макета 42
netdirp1= ; каталог по умолчанию для сохранения макета Р1                                                                                                
log=K:\PDO\KOA\Logs\
[sheet]
fontsize=11
linecount=4 ; количество видимых строк в записе журнала
multiselect=1 ; вкл/откл выбор нескольких строк при работе с журналом
[service]
quartal=4
debug=1
[window] ; расположение и размер главного окна программы
width=1374
height=746
left=-4
top=-4
[update]
firstline=Версия 2.1.3.4 от 10.07.2013

Настройки расположения хранилищ находятся в файле np01vn_dept.ini, ручное редактирование файла в большинстве случаев не требуется - настраивается из интерфейса программы. Пример файла:
[База ПДО - 104] ;наименование базы
netdir=K:\PDO\NP01VN_2\P8\ ;путь к сетевому хранилищу файлов
journaldir=K:\PDO\NP01VN_2\Jrnl\ ; директория хранения таблий журнала
netdir_arc=K:\PDO\NP01VN_ARHIV\104\DATA\ ;архивное хранилие
journaldir_arc=K:\PDO\NP01VN_ARHIV\104\JOURNAL\ ;хранилище журнала
backup_dir=K:\PDO\NP01VN_ARHIV\104\ZIP\ ; хранилище заархивированных резервных копий
mak42_dir=d:\Bases\42\ ; каталог по умолчанию для сохранения макета 42
makP1_dir=d:\Bases\P1\ ; каталог по умолчанию для сохранения макета Р1
  

                            
NP01VN01
--------------


NP01VN02
--------------

                            
NP01VN_CFG



НАЧАЛО ГОДА
==============
В начале нового года необходимо:
По образцу архивов предыдущих лет создать каталог прошедшего года (2013) в соответствующих архивных каталогах (см. каталоги программ выше). Перенос архивов программы Np01VN делается из программы NP01VN_Maket, необходимо включить сервисный режим (кнопка "Замок" затем чекбокс на главной форме), открыть соответствующий журнал, в левом верхнем углу появится кнопка "Архивация и сервисное обслуживание баз", указать количество дней, данные раньше которых должны архивироваться (180 или 270), найти записи и архивировать их. Предварительно рекомендуется создать 7Z архив хранилища. 
ВАЖНО: Создание журнала в архиве не реализовано, по этому необходимо скопировать пустые таблицы журнала в соответствующий каталог. Пустые таблицы журнала находятся в подкаталоге Resource каталога с исходными текстами NP01VN_Maket, они включаются в качестве ресурса в исполняемый модуль. Извлечение необходимо реализовать (по аналогии с основными, не архивными базами).


Архивы прошлых лет программ NP01VN01 и NP01VN02 располагаются соответственно в \\nevz\nevz\ASUP_Data1\BD-ASU\NET\NP01VN\Arc\ и \\nevz\nevz\ASUP_Data1\BD-ASU\NET\NP01VN\ARC02\, расположение этих каталогов берется из bases.dbf расположенного в одном каталоге с программой. Базы прошлых лет копируются в архивный каталог соответствующего года.
ВАЖНО: Новые базы создаются программой NP01VN автоматически при передаче пользователями данных в ОАСУП, в случае отсутствия таблиц. При этом ВОЗМОЖНО может произойти сбой с доступом к файлам (х.з. чего там Казаренок намутил), по-этому в случае ошибки возможно понадобится сбросить пустые базы вручную. Функции создания баз описаны в модуле Arhiv.pas в каталоге с исходными текстами NP01VN.

